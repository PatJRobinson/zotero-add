#! /usr/bin/env nix-shell
#! nix-shell -i python3 -p python3 python3Packages.requests python3Packages.beautifulsoup4 python3Packages.pypdf

"""
zotero_annotate - qutebrowser userscript + CLI for local PDFs

Usage (qutebrowser):
  Bind as userscript; qute will set QUTE_URL / QUTE_TITLE env vars.

Usage (CLI):
  ./zotero_annotate /path/to/file.pdf [optional: source_url]

Credentials:
  Provide Zotero API credentials via either environment variables:
    ZOTERO_API_KEY, ZOTERO_LIBRARY_ID, ZOTERO_LIBRARY_TYPE  (library_type default "user")
  or create ~/.config/zotero/credentials.json:
    {"api_key":"...", "library_id":"1234567", "library_type":"user"}
"""
import sys
from pathlib import Path
from lib.zotero_annotate import ZoteroClient

# Add the project root to sys.path dynamically
sys.path.append(str(Path(__file__).resolve().parent))

client = ZoteroClient()
annotations = client.get_all_annotations(limit=50)

for ann in annotations:
    data = ann["data"]
    print(f"[{data.get('pageLabel')}] {data.get('annotationText')}")
    if comment := data.get("annotationComment"):
        print(f"  Comment: {comment}")
    print()
